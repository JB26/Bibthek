<%include file="header.html" />
<body>
<link rel="stylesheet" href="/static/css/sidebar.css" type="text/css" />
% if user == None or user['username'] != view_user:
  <link rel="stylesheet" href="/static/css/public.css" type="text/css" />
% endif
<div class="navmenu navmenu-default navmenu-fixed-left offcanvas-sm">
% if view == "books":
  <%include file="sidebar.html" />
% elif view == "books2":
  <%include file="sidebar2.html" />
% elif view == "covers":
  <%include file="sidebar_covers.html" />
% elif view == "covers2":
  <%include file="sidebar2_covers.html" />
% endif
</div>
<script>
  var scroll_navmenu = $.localStorage.get('scroll_navmenu')
  if (scroll_navmenu != null) {
    $('.navmenu').scrollTop(scroll_navmenu);
    $.localStorage.remove('scroll_navmenu');
    // Only restore open items if reloading was initiated through clicking on save
    $('.sub_items').each(function() {
      if ( $.localStorage.isSet($( this ).data('name')) ) {
        $( this ).show();
        $.localStorage.remove($( this ).data('name'))
      };
    });
  };
</script>
<div class="navbar navbar-default navbar-fixed-top hidden-md hidden-lg">
  <button type="button" class="navbar-toggle" data-toggle="offcanvas" data-target=".navmenu">
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
    <span class="icon-bar"></span>
  </button>
  <a class="navbar-brand" href="#">BibThek</a>
</div>
<%include file="menu.html" args="current_section=view" />
<link rel="stylesheet" href="/static/css/autocomplete.css" type="text/css" />
<div class="container">
  <form method="post" action="/save${'?book_id=' + book['_id']}" enctype="multipart/form-data" id="book_form" class="form-horizontal">
    <input type="text" id="type" name="type" value="${book['type'] | h}" style="display:none">
    <div class="row">
      <div class="col-md-3">
        <div class="form-group">
          <label for="isbn" class="col-sm-2 control-label">ISBN</label>
          <div class="col-sm-10">
            <input class="form-control" type="text" id="isbn" name="isbn" value="${book['isbn'] | h}"/>
          </div>
        </div>
      </div>
      <div class="col-md-9">
        <div class="form-group">
          <label for="title" class="col-sm-2 control-label">Title</label>
          <div class="col-sm-10">
            <input class="form-control" type="text" id="title" name="title" value="${book['title'] | h}" />
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-3">
        <img src="/${book['front']}" alt="Cover" id="cover" style="width:100%">
      </div>
      <div class="col-md-9">
        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label for="authors" class="col-sm-2 control-label">Author</label>
              <div class="col-sm-10">
                <input class="form-control autocomplete" type="text" id="authors" name="authors" value="${book['authors'] | h}" title="Split multiples with:' & '">
              </div>
            </div>
          </div>
        </div>
        % if book['type'] == 'comic':
        <div class='comic' style="display:block">
        % else:
        <div class='comic' style="display:none">
        % endif
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <label for="artist" class="col-sm-2 control-label">Artist</label>
                <div class="col-sm-10">
                  <input class="form-control" type="text" id="artist" name="artist" value="${book['artist'] | h}" title="Split multiples with:' & '">
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-7">
              <div class="form-group">
                <label for="colorist" class="col-sm-4 control-label">Colorist</label>
                <div class="col-sm-8">
                  <input class="form-control" type="text" id="colorist" name="colorist" value="${book['colorist'] | h}" title="Split multiples with:' & '">
                </div>
              </div>
            </div>
            <div class="col-md-5">
              <div class="form-group">
                <label for="cover_artist" class="col-sm-4 control-label">Cover Artist</label>
                <div class="col-sm-8">
                  <input class="form-control" type="text" id="cover_artist" name="cover_artist" value="${book['cover_artist'] | h}" title="Split multiples with:' & '">
                </div>
              </div>
            </div>
          </div>
        </div>
        % if book['type'] == 'audiobook':
        <div class='audiobook' style="display:block">
        % else:
        <div class='audiobook' style="display:none">
        % endif
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <label for="narrator" class="col-sm-2 control-label">Narrator</label>
                <div class="col-sm-10">
                  <input class="form-control" type="text" id="narrator" name="narrator" value="${book['narrator'] | h}"  title="Split multiples with:' & '">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-7">
            <div class="form-group">
              <label for="publisher" class="col-sm-4 control-label">Publisher</label>
              <div class="col-sm-8">
                <input class="form-control" type="text" id="publisher" name="publisher" value="${book['publisher'] | h}">
              </div>
            </div>
          </div>
          <div class="col-md-5">
            <div class="form-group">
              <label for="release_date" class="col-sm-4 control-label">Published</label>
              <div class="col-sm-8">
                <input class="form-control" type="text" id="release_date" name="release_date" value="${book['release_date'] | h}">
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-7">
            <div class="form-group">
              <label for="series" class="col-sm-4 control-label">Series</label>
              <div class="col-sm-8">
                <input class="form-control" type="text" id="series" name="series" value="${book['series'] | h}">
              </div>
            </div>
          </div>
          <div class="col-md-5">
            <div class="form-group">
              <label for="order_nr" class="col-sm-4 control-label">Order</label>
              <div class="col-sm-8">
                <input class="form-control" type="text" id="order_nr" name="order_nr" value="${book['order_nr'] | h}">
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-7">
            <div class="form-group">
              <label for="language" class="col-sm-4 control-label">Language</label>
              <div class="col-sm-8">
                <input class="form-control" type="text" id="language" name="language" value="${book['language'] | h}">
              </div>
            </div>
          </div>
          <div class="col-md-5">
            <div class="form-group">
              <label for="pages" class="col-sm-4 control-label">Pages</label>
              <div class="col-sm-8">
                <input class="form-control" type="text" id="pages" name="pages" value="${book['pages'] | h}">
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-7">
            <div class="form-group">
              <label for="genre" class="col-sm-4 control-label">Genre</label>
              <div class="col-sm-8">
                <input class="form-control" type="text" id="genre" name="genre" value="${book['genre'] | h}" title="Split multiples with:', '">
              </div>
            </div>
          </div>
          <div class="col-md-5">
            <div class="form-group">
              <label for="form" class="col-sm-4 control-label">Format</label>
              <div class="col-sm-8">
                <input class="form-control" type="text" id="form" name="form" value="${book['form'] | h}">
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-7">
            <div class="form-group">
              <label for="shelf" class="col-sm-4 control-label">Shelf</label>
              <div class="col-sm-8">
                <input class="form-control" type="text" id="shelf" name="shelf" value="${book['shelf'] | h}">
              </div>
            </div>
          </div>
          <div class="col-md-5">
            <div class="form-group">
              <label for="add_date" class="col-sm-4 control-label">Date added</label>
              <div class="col-sm-8">
                <input class="form-control" type="text" id="add_date" name="add_date" value="${book['add_date'] | h}">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-7">
        <label for="front">Cover</label>
        <input type="file" name="front">
      </div>
    </div>
    <div class="row">
      <div class="col-md-7">
        <h3>Description</h3>
        <textarea class="form-control" id="description" name="description" rows="10">${book['description']}</textarea>
        % if user != None and user['username'] == view_user:
          <button class="btn btn-sm btn-success" type="submit" name="save">Save!</button>
          % if book['_id'] == 'new_book':
          <button class="btn btn-sm btn-default" type="submit" name="isbn_search" id="isbn_search">ISBN search</button>
          <a class="btn btn-sm btn-danger" href="/delete${'?book_id=' + book['_id']}" id="delete" style="display:none;">Delete!</a>
          % else:
          <button class="btn btn-sm btn-default" type="submit" name="isbn_search" id="isbn_search" style="display:none;">ISBN search</button>
          <a class="btn btn-sm btn-danger" href="/delete${'?book_id=' + book['_id']}" id="delete">Delete!</a>
          % endif
          <a class="btn btn-sm btn-default" href="https://www.google.de/search?q=${book['isbn']}&tbm=isch" id='isbn_image' target="_blank">
            Cover search
          </a>
          <a class="btn btn-sm btn-default" href="https://www.goodreads.com/search?utf8=%E2%9C%93&query=${book['isbn']}" id='goodreads' target="_blank">
            GoodReads
          </a>
          <a class="btn btn-sm btn-default" href="https://www.amazon.de/gp/search?keywords=${book['isbn']}" id='amazon' target="_blank">
            Amazon search
          </a>
        % endif
      </div>
      <div class="col-md-5">
        <h3>Reading Stats</h3>
        % if user != None and user['username'] == view_user:
        <a href="start_reading" id="start_reading">Start reading</a>
        <a href="delete_reading" id="delete_reading">Delete last</a>
        % endif
        <table class="table table-striped" id="reading_stats">
          <thead>
            <tr>
              <th>#</th>
              <th>Date</th>
              <th>Abdoned</th>
            </tr>
          </thead>
          <tbody>
            % if book['reading_stats'] != None :
              % for i, reading_stats in enumerate(book['reading_stats'], start=1):
                <%include file="reading_stats.html" args="i=i, reading_stats=reading_stats"/>
              % endfor
            % endif
          </tbody>
        </table>
      </div>
    </div>
  % if user == None or user['username'] != view_user:
  </fieldset>
  % endif
  </form>
  % if user == None or user['username'] != view_user:
    <a class="btn btn-sm btn-default" href="https://www.google.de/search?q=${book['isbn']}&tbm=isch" id='isbn_image' target="_blank">
      Cover search
    </a>
    <a class="btn btn-sm btn-default" href="https://www.goodreads.com/search?utf8=%E2%9C%93&query=${book['isbn']}" id='goodreads' target="_blank">
      GoodReads
    </a>
    <a class="btn btn-sm btn-default" href="https://www.amazon.de/gp/search?keywords=${book['isbn']}" id='amazon' target="_blank">
      Amazon search
    </a>
  % endif
</div>
<script>
  var scroll_book = $.localStorage.get('scroll_book')
  if (scroll_book != null) {
    $( window ).scrollTop(scroll_book)
    $.localStorage.remove('scroll_book')
  }
</script>
<script src="/static/js/local_warning.js"></script>
% if error != None:
  <script>
    warning("${error['type']}", "${error['error']}")
  </script>
% endif
<script src="/static/js/local.js"></script>
% if user == None or user['username'] != view_user:
  <script>
    $('.form-control').attr("readonly", "true");
  </script>
% else:
  <script src="/static/js/local_autocomplete.js"></script>
% endif
</body>
</html>
